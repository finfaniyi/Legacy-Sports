{% extends "tournament/base.html" %}
{% load static %}

{% block title %}Team Registration | Legacy Sports{% endblock %}

{% block page_css %}
<link rel="stylesheet" href="{% static 'tournament/css/signup.css' %}">
{% endblock %}

{% block content %}
<section class="form-page">

  <div class="form-header">
    <h1>Team Registration</h1>
    <p>All teams must register 6 players. Substitutes are optional.</p>
  </div>

  <div class="form-card">
    <form method="POST" action="{% url 'registration_team' %}">
      {% csrf_token %}

      {% if error %}
      <div class="error-toast">
        ⚠️ {{ error }}
      </div>
      {% endif %}

      <!-- TEAM INFO -->
      <h3>Team Information</h3>

      <div class="team-grid">
        <input name="team_name" placeholder="Team Name" required>
        <input name="captain_name" placeholder="Captain Full Name" required>
        <input name="captain_email" type="email" placeholder="Captain Email" required>
        <input name="captain_phone" placeholder="Captain Phone" pattern="[0-9+\-\s()]{7,15}"
          title="Enter a valid phone number" required>
      </div>

      <hr>

      <!-- ROSTER SIZE -->
      <h3>Roster Size</h3>

      <select id="rosterSize" name="roster_size" required>
        <option value="">Select</option>
        <option value="6">6 players (no substitutes)</option>
        <option value="7">7 players (1 substitute)</option>
        <option value="8">8 players (2 substitutes)</option>
      </select>

      <hr>

      <!-- ACTIVE PLAYERS -->
      <h3>Active Players (6 required)</h3>

      {% for i in "123456" %}
      <div class="player-card">
        <div class="player-title">Player {{ forloop.counter }}</div>

        <input name="player_{{ forloop.counter }}_first" placeholder="First Name" required>
        <input name="player_{{ forloop.counter }}_last" placeholder="Last Name" required>

        <input name="player_{{ forloop.counter }}_age" type="number" placeholder="Age" min="16" max="60" required>

        <select name="player_{{ forloop.counter }}_gender" required>
          <option value="">Gender</option>
          <option value="M">Male</option>
          <option value="F">Female</option>
          <option value="O">Other</option>
          <option value="N">Prefer not to say</option>
        </select>

        <input name="player_{{ forloop.counter }}_email" type="email" placeholder="Email" required>

        <input name="player_{{ forloop.counter }}_phone" placeholder="Phone" pattern="[0-9+\-\s()]{7,15}"
          title="Enter a valid phone number" required>

        <input name="player_{{ forloop.counter }}_school" placeholder="School (optional)">
      </div>
      {% endfor %}

      <hr>

      <!-- TEAM COLOR -->
      <h3>Team Color</h3>
      <div class="color-grid">
        {% for value, label in team_colors %}
        {% if value in taken_colors %}
        <div class="color-swatch disabled {{ value }}">
          <span>{{ label }}</span>
        </div>
        {% else %}
        <label class="color-swatch {{ value }}">
          <input type="radio" name="team_color" value="{{ value }}" required>
          <span>{{ label }}</span>
        </label>
        {% endif %}
        {% endfor %}
      </div>

      <hr>

      <!-- SUBSTITUTES -->
      <h3>Substitutes</h3>

      <div id="sub-1" style="display:none;">
        <div class="player-card">
          <div class="player-title">Substitute 1</div>

          <input name="sub_1_first" placeholder="First Name">
          <input name="sub_1_last" placeholder="Last Name">
          <input name="sub_1_age" type="number" placeholder="Age" min="16" max="60">

          <select name="sub_1_gender">
            <option value="">Gender</option>
            <option value="M">Male</option>
            <option value="F">Female</option>
            <option value="O">Other</option>
            <option value="N">Prefer not to say</option>
          </select>

          <input name="sub_1_email" type="email" placeholder="Email">
          <input name="sub_1_phone" placeholder="Phone" pattern="[0-9+\-\s()]{7,15}">
          <input name="sub_1_school" placeholder="School (optional)">
        </div>
      </div>

      <div id="sub-2" style="display:none;">
        <div class="player-card">
          <div class="player-title">Substitute 2</div>

          <input name="sub_2_first" placeholder="First Name">
          <input name="sub_2_last" placeholder="Last Name">
          <input name="sub_2_age" type="number" placeholder="Age" min="16" max="60">

          <select name="sub_2_gender">
            <option value="">Gender</option>
            <option value="M">Male</option>
            <option value="F">Female</option>
            <option value="O">Other</option>
            <option value="N">Prefer not to say</option>
          </select>

          <input name="sub_2_email" type="email" placeholder="Email">
          <input name="sub_2_phone" placeholder="Phone" pattern="[0-9+\-\s()]{7,15}">
          <input name="sub_2_school" placeholder="School (optional)">
        </div>
      </div>

      <hr>

      <!-- WAIVER -->
      <h3>Participation Waiver *</h3>

      <div class="waiver-box">
        <p>
          By registering, you agree to the
          <a href="{% url 'waiver' %}" target="_blank" class="waiver-link">
            Legacy Sports Participation Waiver
          </a>.
        </p>
      </div>

      <label class="waiver-checkbox">
        <input type="checkbox" name="agree_waiver" required>
        <span>I confirm that I have read and agree to the waiver.</span>
      </label>


      <button type="submit" id="submitBtn" class="submit-btn">
        Submit Registration
      </button>

    </form>
  </div>
</section>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const rosterSelect = document.getElementById("rosterSize");
    const sub1 = document.getElementById("sub-1");
    const sub2 = document.getElementById("sub-2");

    rosterSelect.addEventListener("change", function () {
      if (this.value === "6") {
        sub1.style.display = "none";
        sub2.style.display = "none";
      } else if (this.value === "7") {
        sub1.style.display = "block";
        sub2.style.display = "none";
      } else if (this.value === "8") {
        sub1.style.display = "block";
        sub2.style.display = "block";
      }
    });
  });
</script>

{% endblock %}